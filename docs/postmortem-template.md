# 事故后分析模板 (Postmortem Template)

## 事故基本信息

### 事故概述
- **事故标题**: [简要描述事故]
- **事故级别**: P0/P1/P2/P3
- **影响范围**: [描述受影响的功能和用户]
- **开始时间**: YYYY-MM-DD HH:MM:SS
- **结束时间**: YYYY-MM-DD HH:MM:SS
- **持续时间**: X 小时 Y 分钟
- **负责人**: [姓名]
- **参与人员**: [列出所有参与人员]

### 业务影响
- **受影响用户数**: [数量]
- **受影响功能**: [列出受影响的功能]
- **业务损失**: [估算的业务损失]
- **用户反馈**: [用户反馈摘要]

## 事故时间线

### 发现阶段
| 时间 | 事件 | 负责人 | 备注 |
|------|------|--------|------|
| HH:MM | 监控告警触发 | 系统 | 自动告警 |
| HH:MM | 事故确认 | [姓名] | 确认事故级别 |
| HH:MM | 响应团队召集 | [姓名] | 启动响应流程 |

### 处理阶段
| 时间 | 事件 | 负责人 | 备注 |
|------|------|--------|------|
| HH:MM | 故障三板斧 - 重启 | [姓名] | 重启相关服务 |
| HH:MM | 故障三板斧 - 回滚 | [姓名] | 回滚到稳定版本 |
| HH:MM | 故障三板斧 - 扩容 | [姓名] | 扩容服务实例 |
| HH:MM | 根因分析 | [姓名] | 分析根本原因 |
| HH:MM | 临时修复 | [姓名] | 实施临时解决方案 |
| HH:MM | 永久修复 | [姓名] | 实施永久解决方案 |

### 恢复阶段
| 时间 | 事件 | 负责人 | 备注 |
|------|------|--------|------|
| HH:MM | 功能验证 | [姓名] | 确认功能正常 |
| HH:MM | 监控确认 | [姓名] | 确认监控正常 |
| HH:MM | 用户通知 | [姓名] | 通知用户恢复 |
| HH:MM | 事故结束 | [姓名] | 正式结束事故 |

## 根因分析

### 直接原因
[描述导致事故的直接原因]

### 根本原因
[分析事故的根本原因，可能包括：]
- **技术原因**: 代码缺陷、配置错误、架构问题
- **流程原因**: 流程缺陷、沟通问题、培训不足
- **人为原因**: 操作失误、判断错误、经验不足
- **外部原因**: 第三方服务问题、网络问题、硬件故障

### 影响链分析
```
[描述事故的影响链，例如：]
数据库连接池耗尽 → 数据库连接超时 → 应用服务异常 → 用户无法访问
```

## 遏制措施

### 立即遏制
[描述立即采取的遏制措施]
- **重启服务**: 重启相关服务恢复功能
- **回滚版本**: 回滚到稳定版本
- **扩容资源**: 增加服务实例和资源
- **切换备用**: 切换到备用系统

### 临时修复
[描述临时修复措施]
- **配置调整**: 调整相关配置参数
- **流量限制**: 限制用户访问流量
- **功能降级**: 关闭非核心功能
- **人工处理**: 人工处理关键请求

## 改进措施

### 技术改进
#### 短期改进 (1-2 周)
- [ ] **代码修复**: 修复导致事故的代码缺陷
- [ ] **配置优化**: 优化相关配置参数
- [ ] **监控增强**: 增加相关监控指标
- [ ] **告警优化**: 优化告警规则和阈值

#### 中期改进 (1-3 个月)
- [ ] **架构优化**: 优化系统架构设计
- [ ] **性能优化**: 提升系统性能
- [ ] **容错增强**: 增强系统容错能力
- [ ] **自动化改进**: 改进自动化流程

#### 长期改进 (3-6 个月)
- [ ] **技术升级**: 升级相关技术栈
- [ ] **架构重构**: 重构系统架构
- [ ] **流程优化**: 优化开发运维流程
- [ ] **团队培训**: 加强团队技能培训

### 流程改进
#### 开发流程
- [ ] **代码审查**: 加强代码审查流程
- [ ] **测试覆盖**: 提高测试覆盖率
- ] **部署流程**: 优化部署流程
- [ ] **回滚流程**: 完善回滚流程

#### 运维流程
- [ ] **监控流程**: 完善监控流程
- [ ] **告警流程**: 优化告警流程
- [ ] **响应流程**: 改进事故响应流程
- [ ] **沟通流程**: 优化沟通流程

#### 管理流程
- [ ] **培训计划**: 制定培训计划
- [ ] **知识管理**: 完善知识管理
- [ ] **经验分享**: 定期经验分享
- [ ] **持续改进**: 建立持续改进机制

## 关键绩效指标 (KPIs)

### 事故指标
- **MTTR (平均恢复时间)**: [目标: < 1 小时]
- **MTBF (平均故障间隔)**: [目标: > 720 小时]
- **事故频率**: [目标: < 1 次/月]
- **事故严重程度**: [目标: P0/P1 < 1 次/季度]

### 业务指标
- **可用性**: [目标: > 99.9%]
- **响应时间**: [目标: P95 < 300ms]
- **错误率**: [目标: < 1%]
- **用户满意度**: [目标: > 4.5/5]

### 技术指标
- **代码质量**: [目标: 测试覆盖率 > 80%]
- **部署频率**: [目标: 每日部署]
- **部署成功率**: [目标: > 95%]
- **监控覆盖率**: [目标: 100%]

## 经验教训

### 成功经验
[总结本次事故处理中的成功经验]
- **快速响应**: 团队快速响应和协作
- **有效沟通**: 及时有效的沟通机制
- **技术能力**: 团队的技术处理能力
- **工具支持**: 相关工具的有效支持

### 失败教训
[总结本次事故处理中的失败教训]
- **预防不足**: 预防措施不够充分
- **监控盲区**: 存在监控盲区
- **流程缺陷**: 相关流程存在缺陷
- **技能不足**: 某些技能需要提升

### 改进建议
[提出具体的改进建议]
- **技术层面**: 技术架构和实现改进
- **流程层面**: 开发运维流程改进
- **管理层面**: 团队管理和培训改进
- **工具层面**: 工具和平台改进

## 行动计划

### 立即行动 (1 周内)
- [ ] **修复代码**: 修复导致事故的代码缺陷
- [ ] **优化配置**: 优化相关配置参数
- [ ] **增强监控**: 增加相关监控指标
- [ ] **完善文档**: 更新相关文档

### 短期行动 (1 个月内)
- [ ] **架构优化**: 优化系统架构设计
- [ ] **流程改进**: 改进相关流程
- [ ] **团队培训**: 组织相关培训
- [ ] **工具升级**: 升级相关工具

### 长期行动 (3 个月内)
- [ ] **技术升级**: 升级相关技术栈
- [ ] **架构重构**: 重构系统架构
- [ ] **流程重构**: 重构相关流程
- [ ] **团队建设**: 加强团队建设

## 附录

### 相关文档
- [事故响应手册](./incident-runbook.md)
- [部署指南](./deployment-guide.md)
- [监控配置](./monitoring-config.md)
- [回滚流程](./rollback-process.md)

### 相关工具
- **监控工具**: Prometheus, Grafana
- **日志工具**: ELK Stack
- **告警工具**: AlertManager
- **部署工具**: Docker, Kubernetes

### 相关脚本
```bash
# 事故响应脚本
./scripts/alert-webhook.sh system-alert "service" "critical" "message" "details"

# 回滚脚本
./scripts/rollback.sh --type full --tag stable --reason "事故回滚"

# 验证脚本
./scripts/verify-deploy.sh --api-url http://localhost:3001

# 维护模式脚本
./scripts/panic-mode.sh --enable
./scripts/panic-mode.sh --disable
```

### 联系方式
- **技术负责人**: [姓名] - [电话] - [邮箱]
- **平台工程师**: [姓名] - [电话] - [邮箱]
- **安全负责人**: [姓名] - [电话] - [邮箱]
- **产品经理**: [姓名] - [电话] - [邮箱]

---

**文档版本**: v1.0  
**最后更新**: YYYY-MM-DD  
**更新人**: [姓名]  
**审核人**: [姓名]
